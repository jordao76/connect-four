{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","app/src/connect-four.coffee","index.min.js","app/src/index.coffee","app/src/spinner.coffee"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","ConnectFour","MAX","MIN","O","X","_","copy","empty","evaluate","freePositions","isFull","isTerminal","isWin","openColumns","openPosition","play","ref","ref1","scores","winOn","winnableIndices","winner","wonIndices","j","k","m","p","q","res","push","sort","x","y","Math","min","apply","i1","i2","i3","i4","len","ref2","ref3","ref4","W","arg","indices","results","columnIndex","index","rowIndex","b","Array","len1","score","a1","nextPlayer","depth","this","prototype","nextAgent","utility","possibleActions","constructor","opponent",2,"$","hideSpinner","showSpinner","jQuery","checkGameOver","computerPlayer","createPlayerO","createPlayerX","game","humanPlayer","lastAction","markWin","newGame","next","playAction","playable","playerO","playerX","players","setup","swapPlayers","teardown","unplayable","className","addClass","removeClass","off","wonClass","endText","text","modal","action","playerText","player","human","starter AI","smart AI","playerName","$o","$x","tmp","on","$btn","$player","currentPlayerName","playerFor","data","int","parseInt","done","playableClassName","$tile","get","id","worker","Worker","onmessage","postMessage","command","args","terminate","lastPlayedPosition","./connect-four","./spinner",3,"spinner","spinnerThresholdMs","spinnerTimeout","Spinner","lines","radius","target","setTimeout","spin","clearTimeout","stop"],"mappings":"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","file":"index.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","# coffeelint: disable=max_line_length\n[MAX, MIN] = ['MAX', 'MIN'] # avoid requiring aye-aye just for these constants\n\n[_, X, O] = [0, 1, 2]\n\n# empty board\nempty = [\n  _, _, _, _, _, _, _\n  _, _, _, _, _, _, _\n  _, _, _, _, _, _, _\n  _, _, _, _, _, _, _\n  _, _, _, _, _, _, _\n  _, _, _, _, _, _, _\n]\n\n# array with all 4-tuple indices of board positions\n# where a player can win the game\nwinnableIndices = do ->\n  res = []\n  for i in [0...4]\n    # rows\n    for j in [0...6]\n      k=i+j*7\n      res.push [k,k+1,k+2,k+3]\n    # left diagonals\n    for j in [0...3]\n      k=i+j*7\n      res.push [k,k+7+1,k+7*2+2,k+7*3+3]\n  for j in [0...3]\n    # columns\n    for i in [0...7]\n      k=i+j*7\n      res.push [k,k+7,k+7*2,k+7*3]\n    # right diagonals\n    for i in [3...7]\n      k=i+j*7\n      res.push [k,k+7-1,k+7*2-2,k+7*3-3]\n  # sort based on bottom-up board position\n  res.sort (x, y) -> (Math.min y...) - (Math.min x...)\n\nwinner = (a) ->\n  for [i1,i2,i3,i4] in winnableIndices\n    return a[i1] if a[i1] isnt _ and a[i1] is a[i2] is a[i3] is a[i4]\n  null\n\nisWin = (a, W) -> (winner a) is W\n\nwonIndices = (a, [i1,i2,i3,i4]) ->\n  a[i1] isnt _ and a[i1] is a[i2] is a[i3] is a[i4]\n\nwinOn = (a) ->\n  for indices in winnableIndices\n    return indices if wonIndices a, indices\n  []\n\nisFull = (a) ->\n  for i in [0...7]\n    return no if a[i] is _\n  yes\n\nisTerminal = (a) ->\n  (isFull a) or !!(winner a)\n\nopenColumns = (a) ->\n  i for i in [0...7] when a[i] is _\n\nfreePositions = (a) ->\n  i for i in [0...42] when a[i] is _\n\nopenPosition = (a, columnIndex) ->\n  for rowIndex in [5..0]\n    index = rowIndex*7+columnIndex\n    return index if a[index] is _\n\n# this is a bit faster than using Array::slice\ncopy = (a) ->\n  i = 42\n  b = new Array i\n  b[i] = a[i] while i--\n  b\n\nplay = (a, columnIndex, W) ->\n  index = openPosition a, columnIndex\n  b = copy a\n  b[index] = W\n  b\n\nscores = [1,10,100,1000,10000]\nevaluate = (a) ->\n  score = 0\n  for indices in winnableIndices\n    [x, o] = [0, 0]\n    for i in indices\n      ++x if a[i] is X\n      ++o if a[i] is O\n    score += scores[x] - scores[o] if x is 0 or o is 0\n  score\n\nclass ConnectFour\n  constructor: (@a = empty, @nextPlayer = X, @depth = 0) ->\n  isWin: (W) -> isWin @a, W\n  winOn: -> winOn @a\n  winner: -> winner @a\n  isTerminal: -> @depth >= 7 and isTerminal @a\n  nextAgent: -> if @nextPlayer is X then MAX else MIN\n  utility: -> evaluate @a\n  freePositions: -> freePositions @a\n  openPosition: (columnIndex) -> openPosition @a, columnIndex\n  possibleActions: -> openColumns @a\n  play: (columnIndex) ->\n    new @constructor (play @a, columnIndex, @nextPlayer), @opponent(), @depth + 1\n  opponent: -> if @nextPlayer is X then O else X\n\nmodule.exports = {\n  _, X, O\n  empty\n  winner, isWin, winOn, isFull, isTerminal\n  freePositions, openColumns, openPosition, play, evaluate\n  ConnectFour\n}\n","(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nvar ConnectFour, MAX, MIN, O, X, _, copy, empty, evaluate, freePositions, isFull, isTerminal, isWin, openColumns, openPosition, play, ref, ref1, scores, winOn, winnableIndices, winner, wonIndices;\n\nref = ['MAX', 'MIN'], MAX = ref[0], MIN = ref[1];\n\nref1 = [0, 1, 2], _ = ref1[0], X = ref1[1], O = ref1[2];\n\nempty = [_, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _];\n\nwinnableIndices = (function() {\n  var i, j, k, l, m, n, p, q, r, res;\n  res = [];\n  for (i = l = 0; l < 4; i = ++l) {\n    for (j = m = 0; m < 6; j = ++m) {\n      k = i + j * 7;\n      res.push([k, k + 1, k + 2, k + 3]);\n    }\n    for (j = n = 0; n < 3; j = ++n) {\n      k = i + j * 7;\n      res.push([k, k + 7 + 1, k + 7 * 2 + 2, k + 7 * 3 + 3]);\n    }\n  }\n  for (j = p = 0; p < 3; j = ++p) {\n    for (i = q = 0; q < 7; i = ++q) {\n      k = i + j * 7;\n      res.push([k, k + 7, k + 7 * 2, k + 7 * 3]);\n    }\n    for (i = r = 3; r < 7; i = ++r) {\n      k = i + j * 7;\n      res.push([k, k + 7 - 1, k + 7 * 2 - 2, k + 7 * 3 - 3]);\n    }\n  }\n  return res.sort(function(x, y) {\n    return (Math.min.apply(Math, y)) - (Math.min.apply(Math, x));\n  });\n})();\n\nwinner = function(a) {\n  var i1, i2, i3, i4, l, len, ref2, ref3, ref4;\n  for (l = 0, len = winnableIndices.length; l < len; l++) {\n    ref2 = winnableIndices[l], i1 = ref2[0], i2 = ref2[1], i3 = ref2[2], i4 = ref2[3];\n    if (a[i1] !== _ && ((a[i1] === (ref4 = a[i2]) && ref4 === (ref3 = a[i3])) && ref3 === a[i4])) {\n      return a[i1];\n    }\n  }\n  return null;\n};\n\nisWin = function(a, W) {\n  return (winner(a)) === W;\n};\n\nwonIndices = function(a, arg) {\n  var i1, i2, i3, i4, ref2, ref3;\n  i1 = arg[0], i2 = arg[1], i3 = arg[2], i4 = arg[3];\n  return a[i1] !== _ && ((a[i1] === (ref3 = a[i2]) && ref3 === (ref2 = a[i3])) && ref2 === a[i4]);\n};\n\nwinOn = function(a) {\n  var indices, l, len;\n  for (l = 0, len = winnableIndices.length; l < len; l++) {\n    indices = winnableIndices[l];\n    if (wonIndices(a, indices)) {\n      return indices;\n    }\n  }\n  return [];\n};\n\nisFull = function(a) {\n  var i, l;\n  for (i = l = 0; l < 7; i = ++l) {\n    if (a[i] === _) {\n      return false;\n    }\n  }\n  return true;\n};\n\nisTerminal = function(a) {\n  return (isFull(a)) || !!(winner(a));\n};\n\nopenColumns = function(a) {\n  var i, l, results;\n  results = [];\n  for (i = l = 0; l < 7; i = ++l) {\n    if (a[i] === _) {\n      results.push(i);\n    }\n  }\n  return results;\n};\n\nfreePositions = function(a) {\n  var i, l, results;\n  results = [];\n  for (i = l = 0; l < 42; i = ++l) {\n    if (a[i] === _) {\n      results.push(i);\n    }\n  }\n  return results;\n};\n\nopenPosition = function(a, columnIndex) {\n  var index, l, rowIndex;\n  for (rowIndex = l = 5; l >= 0; rowIndex = --l) {\n    index = rowIndex * 7 + columnIndex;\n    if (a[index] === _) {\n      return index;\n    }\n  }\n};\n\ncopy = function(a) {\n  var b, i;\n  i = 42;\n  b = new Array(i);\n  while (i--) {\n    b[i] = a[i];\n  }\n  return b;\n};\n\nplay = function(a, columnIndex, W) {\n  var b, index;\n  index = openPosition(a, columnIndex);\n  b = copy(a);\n  b[index] = W;\n  return b;\n};\n\nscores = [1, 10, 100, 1000, 10000];\n\nevaluate = function(a) {\n  var i, indices, l, len, len1, m, o, ref2, score, x;\n  score = 0;\n  for (l = 0, len = winnableIndices.length; l < len; l++) {\n    indices = winnableIndices[l];\n    ref2 = [0, 0], x = ref2[0], o = ref2[1];\n    for (m = 0, len1 = indices.length; m < len1; m++) {\n      i = indices[m];\n      if (a[i] === X) {\n        ++x;\n      }\n      if (a[i] === O) {\n        ++o;\n      }\n    }\n    if (x === 0 || o === 0) {\n      score += scores[x] - scores[o];\n    }\n  }\n  return score;\n};\n\nConnectFour = (function() {\n  function ConnectFour(a1, nextPlayer, depth) {\n    this.a = a1 != null ? a1 : empty;\n    this.nextPlayer = nextPlayer != null ? nextPlayer : X;\n    this.depth = depth != null ? depth : 0;\n  }\n\n  ConnectFour.prototype.isWin = function(W) {\n    return isWin(this.a, W);\n  };\n\n  ConnectFour.prototype.winOn = function() {\n    return winOn(this.a);\n  };\n\n  ConnectFour.prototype.winner = function() {\n    return winner(this.a);\n  };\n\n  ConnectFour.prototype.isTerminal = function() {\n    return this.depth >= 7 && isTerminal(this.a);\n  };\n\n  ConnectFour.prototype.nextAgent = function() {\n    if (this.nextPlayer === X) {\n      return MAX;\n    } else {\n      return MIN;\n    }\n  };\n\n  ConnectFour.prototype.utility = function() {\n    return evaluate(this.a);\n  };\n\n  ConnectFour.prototype.freePositions = function() {\n    return freePositions(this.a);\n  };\n\n  ConnectFour.prototype.openPosition = function(columnIndex) {\n    return openPosition(this.a, columnIndex);\n  };\n\n  ConnectFour.prototype.possibleActions = function() {\n    return openColumns(this.a);\n  };\n\n  ConnectFour.prototype.play = function(columnIndex) {\n    return new this.constructor(play(this.a, columnIndex, this.nextPlayer), this.opponent(), this.depth + 1);\n  };\n\n  ConnectFour.prototype.opponent = function() {\n    if (this.nextPlayer === X) {\n      return O;\n    } else {\n      return X;\n    }\n  };\n\n  return ConnectFour;\n\n})();\n\nmodule.exports = {\n  _: _,\n  X: X,\n  O: O,\n  empty: empty,\n  winner: winner,\n  isWin: isWin,\n  winOn: winOn,\n  isFull: isFull,\n  isTerminal: isTerminal,\n  freePositions: freePositions,\n  openColumns: openColumns,\n  openPosition: openPosition,\n  play: play,\n  evaluate: evaluate,\n  ConnectFour: ConnectFour\n};\n\n\n},{}],2:[function(require,module,exports){\nvar $, ConnectFour, O, X, hideSpinner, ref, ref1, showSpinner;\n\n$ = jQuery;\n\nref = require('./connect-four'), X = ref.X, O = ref.O, ConnectFour = ref.ConnectFour;\n\nref1 = require('./spinner'), showSpinner = ref1.showSpinner, hideSpinner = ref1.hideSpinner;\n\n$(function() {\n  var checkGameOver, computerPlayer, createPlayerO, createPlayerX, game, humanPlayer, lastAction, markWin, newGame, next, playAction, playable, playerO, playerX, players, setup, swapPlayers, teardown, unplayable;\n  game = null;\n  lastAction = null;\n  playable = function() {\n    var className, i, j, len, ref2;\n    className = game.nextPlayer === X ? 'x-playable-tile' : 'o-playable-tile';\n    ref2 = game.freePositions();\n    for (j = 0, len = ref2.length; j < len; j++) {\n      i = ref2[j];\n      $(\"#\" + i).addClass(className);\n    }\n    return className;\n  };\n  unplayable = function() {\n    return $('.tile').removeClass('x-playable-tile').removeClass('o-playable-tile').removeClass('human-playable-tile').off('click');\n  };\n  markWin = function() {\n    var i, j, len, ref2, results, wonClass;\n    ref2 = game.winOn();\n    results = [];\n    for (j = 0, len = ref2.length; j < len; j++) {\n      i = ref2[j];\n      wonClass = game.isWin(X) ? 'x-won-tile' : 'o-won-tile';\n      results.push(($(\"#\" + i)).addClass(wonClass));\n    }\n    return results;\n  };\n  checkGameOver = function() {\n    var endText;\n    if (!game.isTerminal()) {\n      return false;\n    }\n    endText = (function() {\n      switch (false) {\n        case !game.isWin(X):\n          return 'Green Wins!';\n        case !game.isWin(O):\n          return 'Red Wins!';\n        default:\n          return 'Draw!';\n      }\n    })();\n    $('#end-text').text(endText);\n    $('#modal-game-over').modal('show');\n    return true;\n  };\n  playAction = function(action) {\n    var columnIndex, index, playerText;\n    columnIndex = action % 7;\n    hideSpinner();\n    index = game.openPosition(columnIndex);\n    playerText = game.nextPlayer === X ? 'x' : 'o';\n    ($(\"#\" + index)).addClass(playerText + '-tile');\n    game = game.play(action);\n    lastAction = action;\n    return next();\n  };\n  playerX = null;\n  playerO = null;\n  next = function() {\n    var player;\n    unplayable();\n    markWin();\n    player = game.nextPlayer === X ? playerX : playerO;\n    return player.play();\n  };\n  players = {\n    human: function() {\n      return humanPlayer();\n    },\n    'starter AI': function() {\n      return computerPlayer(3);\n    },\n    'smart AI': function() {\n      return computerPlayer(4);\n    }\n  };\n  createPlayerX = function() {\n    var playerName;\n    playerName = ($('#btn-player-x')).text();\n    return players[playerName]();\n  };\n  createPlayerO = function() {\n    var playerName;\n    playerName = ($('#btn-player-o')).text();\n    return players[playerName]();\n  };\n  swapPlayers = function() {\n    var $o, $x, tmp;\n    $x = $('#btn-player-x');\n    $o = $('#btn-player-o');\n    tmp = $x.text();\n    $x.text($o.text());\n    return $o.text(tmp);\n  };\n  $('.player').on('click', function() {\n    var $btn, $player, currentPlayerName, playerFor, playerName;\n    $player = $(this);\n    playerFor = $player.data('player-for');\n    $btn = $(\"#btn-player-\" + playerFor);\n    playerName = $player.text();\n    currentPlayerName = $btn.text();\n    if (currentPlayerName !== playerName) {\n      $btn.text(playerName);\n      return setup();\n    }\n  });\n  humanPlayer = function() {\n    var int;\n    int = function(s) {\n      return parseInt(s, 10);\n    };\n    return {\n      setup: function(done) {\n        return done();\n      },\n      play: function() {\n        var playableClassName;\n        if (checkGameOver()) {\n          return;\n        }\n        playableClassName = playable();\n        return $(\".\" + playableClassName).addClass('human-playable-tile').on('click', function() {\n          var $tile, action;\n          $tile = $(this);\n          action = int($tile.get(0).id);\n          return playAction(action);\n        });\n      }\n    };\n  };\n  computerPlayer = function(depth) {\n    var worker;\n    if (depth == null) {\n      depth = 3;\n    }\n    worker = new Worker('src/minimax-worker.min.js');\n    return {\n      setup: function(done) {\n        worker.onmessage = function(e) {\n          return playAction(e.data.action);\n        };\n        worker.postMessage({\n          command: 'setup',\n          args: {\n            depth: depth\n          }\n        });\n        return done();\n      },\n      play: function() {\n        if (checkGameOver()) {\n          return;\n        }\n        playable();\n        showSpinner();\n        return worker.postMessage({\n          command: 'play',\n          args: {\n            lastAction: lastAction\n          }\n        });\n      },\n      teardown: function() {\n        return worker.terminate();\n      }\n    };\n  };\n  setup = function() {\n    var ref2;\n    teardown();\n    game = new ConnectFour;\n    game.lastPlayedPosition = null;\n    lastAction = null;\n    ref2 = [createPlayerX(), createPlayerO()], playerX = ref2[0], playerO = ref2[1];\n    return playerX.setup(function() {\n      return playerO.setup(function() {\n        return next();\n      });\n    });\n  };\n  teardown = function() {\n    if (playerX != null) {\n      if (typeof playerX.teardown === \"function\") {\n        playerX.teardown();\n      }\n    }\n    if (playerO != null) {\n      if (typeof playerO.teardown === \"function\") {\n        playerO.teardown();\n      }\n    }\n    hideSpinner();\n    return $('.tile').removeClass('x-tile').removeClass('o-tile').removeClass('x-won-tile').removeClass('o-won-tile');\n  };\n  newGame = function() {\n    swapPlayers();\n    return setup();\n  };\n  $('#btn-new-game').on('click', newGame);\n  return setup();\n});\n\n\n},{\"./connect-four\":1,\"./spinner\":3}],3:[function(require,module,exports){\nvar $, hideSpinner, showSpinner, spinner, spinnerThresholdMs, spinnerTimeout;\n\n$ = jQuery;\n\nspinner = new Spinner({\n  lines: 9,\n  radius: 7,\n  length: 7\n});\n\nspinnerTimeout = null;\n\nspinnerThresholdMs = 100;\n\nshowSpinner = function() {\n  var target;\n  if (spinnerTimeout == null) {\n    target = ($('#spinner')).get(0);\n    return spinnerTimeout = setTimeout((function() {\n      return spinner.spin(target);\n    }), spinnerThresholdMs);\n  }\n};\n\nhideSpinner = function() {\n  if (spinnerTimeout != null) {\n    clearTimeout(spinnerTimeout);\n  }\n  spinner.stop();\n  return spinnerTimeout = null;\n};\n\nmodule.exports = {\n  showSpinner: showSpinner,\n  hideSpinner: hideSpinner\n};\n\n\n},{}]},{},[2])\n\n","  # coffeelint: disable=max_line_length\n\n$ = jQuery\n\n{X, O, ConnectFour} = require './connect-four'\n\n{showSpinner, hideSpinner} = require './spinner'\n\n$ ->\n\n  game = null\n  lastAction = null\n\n  playable = ->\n    className =\n      if game.nextPlayer is X then 'x-playable-tile' else 'o-playable-tile'\n    for i in game.freePositions()\n      $ \"##{i}\"\n        .addClass className\n    className\n\n  unplayable = ->\n    $ '.tile'\n      .removeClass 'x-playable-tile'\n      .removeClass 'o-playable-tile'\n      .removeClass 'human-playable-tile'\n      .off 'click'\n\n  markWin = ->\n    for i in game.winOn()\n      wonClass = if game.isWin X then 'x-won-tile' else 'o-won-tile'\n      ($ \"##{i}\").addClass wonClass\n\n  checkGameOver = ->\n    return no unless game.isTerminal()\n    endText = switch\n      when game.isWin X then 'Green Wins!'\n      when game.isWin O then 'Red Wins!'\n      else 'Draw!'\n    $ '#end-text'\n      .text endText\n    $ '#modal-game-over'\n      .modal('show')\n    yes\n\n  playAction = (action) ->\n    columnIndex = action % 7\n    hideSpinner()\n    index = game.openPosition columnIndex\n    playerText = if game.nextPlayer is X then 'x' else 'o'\n    ($ \"##{index}\").addClass playerText + '-tile'\n    game = game.play action\n    lastAction = action\n    next()\n\n  # player :: {\n  #   setup : (done: ->) ->\n  #   teardown : ->\n  #   play : ->\n  # }\n\n  playerX = null\n  playerO = null\n\n  next = ->\n    unplayable()\n    markWin()\n    player = if game.nextPlayer is X then playerX else playerO\n    player.play()\n\n  players =\n    human: -> humanPlayer()\n    'starter AI': -> computerPlayer 3\n    'smart AI': -> computerPlayer 4\n\n  createPlayerX = ->\n    playerName = ($ '#btn-player-x').text()\n    players[playerName]()\n  createPlayerO = ->\n    playerName = ($ '#btn-player-o').text()\n    players[playerName]()\n\n  swapPlayers = ->\n    $x = $ '#btn-player-x'\n    $o = $ '#btn-player-o'\n    tmp = $x.text()\n    $x.text $o.text()\n    $o.text tmp\n\n  $ '.player'\n    .on 'click', ->\n      $player = $ this\n      playerFor = $player.data 'player-for'\n      $btn = $ \"#btn-player-#{playerFor}\"\n      playerName = $player.text()\n      currentPlayerName = $btn.text()\n      if currentPlayerName isnt playerName\n        $btn.text playerName\n        setup()\n\n  humanPlayer = ->\n    int = (s) -> parseInt s, 10\n    setup: (done) -> done()\n    play: ->\n      return if checkGameOver()\n      playableClassName = playable()\n      $ \".#{playableClassName}\"\n        .addClass 'human-playable-tile'\n        .on 'click', ->\n          $tile = $ this\n          action = int $tile.get(0).id\n          playAction action\n\n  computerPlayer = (depth = 3) ->\n    worker = new Worker 'src/minimax-worker.min.js'\n    setup: (done) ->\n      worker.onmessage = (e) -> playAction e.data.action\n      worker.postMessage command: 'setup', args: {depth}\n      done()\n    play: ->\n      return if checkGameOver()\n      playable()\n      showSpinner()\n      worker.postMessage command: 'play', args: {lastAction}\n    teardown: -> worker.terminate()\n\n  setup = ->\n    teardown()\n    game = new ConnectFour\n    game.lastPlayedPosition = null # start with the full board open\n    lastAction = null\n    [playerX, playerO] = [createPlayerX(), createPlayerO()]\n    playerX.setup -> playerO.setup -> next()\n\n  teardown = ->\n    playerX?.teardown?()\n    playerO?.teardown?()\n    hideSpinner()\n    $ '.tile'\n      .removeClass 'x-tile'\n      .removeClass 'o-tile'\n      .removeClass 'x-won-tile'\n      .removeClass 'o-won-tile'\n\n  newGame = ->\n    swapPlayers()\n    setup()\n\n  $ '#btn-new-game'\n    .on 'click', newGame\n\n  setup()\n","$ = jQuery\r\n\r\nspinner = new Spinner lines: 9, radius: 7, length: 7\r\nspinnerTimeout = null\r\nspinnerThresholdMs = 100\r\nshowSpinner = ->\r\n  unless spinnerTimeout?\r\n    target = ($ '#spinner').get 0\r\n    spinnerTimeout =\r\n      setTimeout (-> spinner.spin target), spinnerThresholdMs\r\nhideSpinner = ->\r\n  clearTimeout spinnerTimeout if spinnerTimeout?\r\n  spinner.stop()\r\n  spinnerTimeout = null\r\n\r\nmodule.exports = {showSpinner, hideSpinner}\r\n"],"sourceRoot":"/source/"}