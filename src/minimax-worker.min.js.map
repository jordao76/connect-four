{"version":3,"sources":["node_modules/browser-pack/_prelude.js","app/src/connect-four.coffee","minimax-worker.min.js","app/src/minimax-worker.coffee","node_modules/aye-aye/lib/game.js","node_modules/aye-aye/lib/minimax.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","ConnectFour","MAX","MIN","O","X","_","copy","empty","evaluate","freePositions","isFull","isTerminal","isWin","openColumns","openPosition","play","ref","ref1","repr","scores","winOn","winnableIndices","winner","wonIndices","j","k","l","m","q","res","push","sort","x","y","Math","min","apply","i1","i2","i3","i4","len","ref2","ref3","ref4","W","arg","indices","results","columnIndex","index","rowIndex","b","Array","len1","score","boardStr","col","piece","row","a1","nextPlayer","depth","this","prototype","nextAgent","utility","possibleActions","constructor","opponent","toString","aye-aye","2","Game","MinimaxAgent","computerPlayer","game","player","random","shuffle","floor","self","onmessage","action","lastAction","data","command","args","postMessage","agent","nextAction","./connect-four","3","P1","P2","4","Limit","Number","MAX_SAFE_INTEGER","rootAgent","state","bestAction","minimax","α","β","ply","maxi","mini","nextValue","ref5","successor","v","max","./game"],"mappings":"CAAA,WAAA,QAAAA,GAAAC,EAAAC,EAAAC,GAAA,QAAAC,GAAAC,EAAAC,GAAA,IAAAJ,EAAAG,GAAA,CAAA,IAAAJ,EAAAI,GAAA,CAAA,GAAAE,GAAA,kBAAAC,UAAAA,OAAA,KAAAF,GAAAC,EAAA,MAAAA,GAAAF,GAAA,EAAA,IAAAI,EAAA,MAAAA,GAAAJ,GAAA,EAAA,IAAAK,GAAA,GAAAC,OAAA,uBAAAN,EAAA,IAAA,MAAAK,GAAAE,KAAA,mBAAAF,EAAA,GAAAG,GAAAX,EAAAG,IAAAS,WAAAb,GAAAI,GAAA,GAAAU,KAAAF,EAAAC,QAAA,SAAAd,GAAA,GAAAE,GAAAD,EAAAI,GAAA,GAAAL,EAAA,OAAAI,GAAAF,GAAAF,IAAAa,EAAAA,EAAAC,QAAAd,EAAAC,EAAAC,EAAAC,GAAA,MAAAD,GAAAG,GAAAS,QAAA,IAAA,GAAAL,GAAA,kBAAAD,UAAAA,QAAAH,EAAA,EAAAA,EAAAF,EAAAa,OAAAX,IAAAD,EAAAD,EAAAE,GAAA,OAAAD,GAAA,MAAAJ,OAAAiB,GAAA,SAAAT,EAAAU,EAAAJ,GCCA,GAAAK,GAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,CAAAP,GAAa3B,EAAQ,WAApBY,EAAAe,EAAAf,IAAKC,EAAAc,EAAAd,IAENe,GAAa,EAAG,EAAG,GAAlBZ,EAAAY,EAAA,GAAGb,EAAAa,EAAA,GAAGd,EAAAc,EAAA,GAGPV,GACEF,EAAGA,EAAGA,EAAGA,EAAGA,EAAGA,EAAGA,EAClBA,EAAGA,EAAGA,EAAGA,EAAGA,EAAGA,EAAGA,EAClBA,EAAGA,EAAGA,EAAGA,EAAGA,EAAGA,EAAGA,EAClBA,EAAGA,EAAGA,EAAGA,EAAGA,EAAGA,EAAGA,EAClBA,EAAGA,EAAGA,EAAGA,EAAGA,EAAGA,EAAGA,EAClBA,EAAGA,EAAGA,EAAGA,EAAGA,EAAGA,EAAGA,GAKpBgB,EAAqB,WACnB,GAAAnC,GAAAsC,EAAAC,EAAAC,EAAAC,EAAA5C,EAAAW,EAAAkC,EAAA/C,EAAAgD,CACA,KADAA,KACS3C,EAAAwC,EAAA,EAAAA,EAAA,EAAAxC,IAAAwC,EAAT,CAEE,IAASF,EAAAG,EAAA,EAAAA,EAAA,EAAAH,IAAAG,EACPF,EAAEvC,EAAI,EAAFsC,EACJK,EAAIC,MAAML,EAAEA,EAAE,EAAEA,EAAE,EAAEA,EAAE,GAExB,KAASD,EAAAzC,EAAA,EAAAA,EAAA,EAAAyC,IAAAzC,EACP0C,EAAEvC,EAAI,EAAFsC,EACJK,EAAIC,MAAML,EAAEA,EAAE,EAAE,EAAEA,EAAE,GAAI,EAAEA,EAAE,GAAI,IACpC,IAASD,EAAA9B,EAAA,EAAAA,EAAA,EAAA8B,IAAA9B,EAAT,CAEE,IAASR,EAAA0C,EAAA,EAAAA,EAAA,EAAA1C,IAAA0C,EACPH,EAAEvC,EAAI,EAAFsC,EACJK,EAAIC,MAAML,EAAEA,EAAE,EAAEA,EAAE,GAAIA,EAAE,IAE1B,KAASvC,EAAAL,EAAA,EAAAA,EAAA,EAAAK,IAAAL,EACP4C,EAAEvC,EAAI,EAAFsC,EACJK,EAAIC,MAAML,EAAEA,EAAE,EAAE,EAAEA,EAAE,GAAI,EAAEA,EAAE,GAAI,ICJpC,MDMAI,GAAIE,KAAK,SAACC,EAAGC,GCLX,MDKkBC,MAAKC,IAALC,MAAAF,KAASD,GAASC,KAAKC,IAALC,MAAAF,KAASF,QAEjDV,EAAS,SAAC/B,GACR,GAAA8C,GAAAC,EAAAC,EAAAC,EAAAd,EAAAe,EAAAC,EAAAC,EAAAC,CAAA,KAAAlB,EAAA,EAAAe,EAAApB,EAAAxB,OAAA6B,EAAAe,EAAAf,IACE,GCFAgB,EAAOrB,EAAgBK,GDCpBW,EAAAK,EAAA,GAAGJ,EAAAI,EAAA,GAAGH,EAAAG,EAAA,GAAGF,EAAAE,EAAA,GACInD,EAAE8C,KAAShC,GAAMd,EAAE8C,MAAFO,EAASrD,EAAE+C,KAAXM,KAAAD,EAAkBpD,EAAEgD,KAApBI,IAA2BpD,EAAEiD,GAA9D,MAAOjD,GAAE8C,ECGX,ODFA,OAEFzB,EAAQ,SAACrB,EAAGsD,GCIV,MDJiBvB,GAAO/B,KAAMsD,GAEhCtB,EAAa,SAAChC,EAAGuD,GACf,GAAAT,GAAAC,EAAAC,EAAAC,EAAAE,EAAAC,CCOA,ODRgBN,GAAAS,EAAA,GAAGR,EAAAQ,EAAA,GAAGP,EAAAO,EAAA,GAAGN,EAAAM,EAAA,GACzBvD,EAAE8C,KAAShC,GAAMd,EAAE8C,MAAFM,EAASpD,EAAE+C,KAAXK,KAAAD,EAAkBnD,EAAEgD,KAApBG,IAA2BnD,EAAEiD,IAEhDpB,EAAQ,SAAC7B,GACP,GAAAwD,GAAArB,EAAAe,CAAA,KAAAf,EAAA,EAAAe,EAAApB,EAAAxB,OAAA6B,EAAAe,EAAAf,IACE,GCSAqB,EAAU1B,EAAgBK,GDTRH,EAAWhC,EAAGwD,GAAhC,MAAOA,ECcT,WDXFrC,EAAS,SAACnB,GACR,GAAAL,GAAAwC,CAAA,KAASxC,EAAAwC,EAAA,EAAAA,EAAA,EAAAxC,IAAAwC,EACP,GAAanC,EAAEL,KAAMmB,EAArB,OAAO,CCmBT,QDlBA,GAEFM,EAAa,SAACpB,GCoBZ,MDnBCmB,GAAOnB,MAAS+B,EAAO/B,IAE1BsB,EAAc,SAACtB,GACb,GAAAL,GAAAwC,EAAAsB,CCsBA,KDtBAA,KAAW9D,EAAAwC,EAAA,EAAAA,EAAA,EAAAxC,IAAAwC,EAAanC,EAAEL,KAAMmB,GCwB5B2C,EAAQlB,KDxBZ5C,EC2BA,OAAO8D,IDzBTvC,EAAgB,SAAClB,GACf,GAAAL,GAAAwC,EAAAsB,CC8BA,KD9BAA,KAAW9D,EAAAwC,EAAA,EAAAA,EAAA,GAAAxC,IAAAwC,EAAcnC,EAAEL,KAAMmB,GCgC7B2C,EAAQlB,KDhCZ5C,ECmCA,OAAO8D,IDjCTlC,EAAe,SAACvB,EAAG0D,GACjB,GAAAC,GAAAxB,EAAAyB,CAAA,KAAgBA,EAAAzB,EAAA,EAAAA,GAAA,EAAAyB,IAAAzB,EAEd,GADAwB,EAAiB,EAATC,EAAWF,EACH1D,EAAE2D,KAAU7C,EAA5B,MAAO6C,IAGX5C,EAAO,SAACf,GACN,GAAA6D,GAAAlE,CAEY,KAFZA,EAAI,GACJkE,EAAI,GAAIC,OAAMnE,GACIA,KAAlBkE,EAAElE,GAAKK,EAAEL,EC4CT,OD3CAkE,IAEFrC,EAAO,SAACxB,EAAG0D,EAAaJ,GACtB,GAAAO,GAAAF,CCgDA,ODhDAA,GAAQpC,EAAavB,EAAG0D,GACxBG,EAAI9C,EAAKf,GACT6D,EAAEF,GAASL,EACXO,GAEFjC,GAAU,EAAE,GAAG,IAAI,IAAK,KACxBX,EAAW,SAACjB,GACV,GAAAL,GAAA6D,EAAArB,EAAAe,EAAAa,EAAA3B,EAAA1C,EAAAyD,EAAAa,EAAAvB,CACA,KADAuB,EAAQ,EACR7B,EAAA,EAAAe,EAAApB,EAAAxB,OAAA6B,EAAAe,EAAAf,IAAA,CAEE,IC+CAqB,EAAU1B,EAAgBK,GDhD1BgB,GAAU,EAAG,GAAZV,EAAAU,EAAA,GAAGzD,EAAAyD,EAAA,GACJf,EAAA,EAAA2B,EAAAP,EAAAlD,OAAA8B,EAAA2B,EAAA3B,ICkDEzC,EAAI6D,EAAQpB,GDjDLpC,EAAEL,KAAMkB,KAAb4B,EACKzC,EAAEL,KAAMiB,KAAblB,CACmC,KAAL+C,GAAe,IAAL/C,IAA5CsE,GAASpC,EAAOa,GAAKb,EAAOlC,IC2D9B,MD1DAsE,IAEFrC,EAAO,SAAC3B,GACN,GAAAiE,GAAAC,EAAA/B,EAAAC,EAAA+B,EAAAC,CACA,KADAH,EAAW,GACAG,EAAAjC,EAAA,EAAAA,EAAA,EAAAiC,IAAAjC,EAAX,CACE,IAAW+B,EAAA9B,EAAA,EAAAA,EAAA,EAAA8B,IAAA9B,EACT+B,EAAQnE,EAAQ,EAANoE,EAAUF,GAElBD,GADCE,IAAStD,EACE,KACNsD,IAASvD,EACH,KAEA,IAChBqD,IAAY,KCgEd,MD/DAA,IAEIxD,EAAA,WACS,QAAAA,GAAC4D,EAAYC,EAAiBC,GAA7BC,KAACxE,EAAA,MAAAqE,EAADA,EAAKrD,EAAOwD,KAACF,WAAA,MAAAA,EAADA,EAAczD,EAAG2D,KAACD,MAAA,MAAAA,EAADA,EAAS,EC8HpD,MAxDA9D,GAAYgE,UDrEZpD,MAAO,SAACiC,GCsEN,MDtEYjC,GAAMmD,KAACxE,EAAGsD,ICyExB7C,EAAYgE,UDxEZ5C,MAAO,WCyEL,MDzEQA,GAAM2C,KAACxE,IC4EjBS,EAAYgE,UD3EZ1C,OAAQ,WC4EN,MD5ESA,GAAOyC,KAACxE,IC+EnBS,EAAYgE,UD9EZrD,WAAY,WC+EV,MD/EaoD,MAACD,OAAS,GAAMnD,EAAWoD,KAACxE,ICkF3CS,EAAYgE,UDjFZC,UAAW,WAAG,MAAGF,MAACF,aAAczD,EAAOH,EAASC,GCyFhDF,EAAYgE,UDxFZE,QAAS,WCyFP,MDzFU1D,GAASuD,KAACxE,IC4FtBS,EAAYgE,UD3FZvD,cAAe,WC4Fb,MD5FgBA,GAAcsD,KAACxE,IC+FjCS,EAAYgE,UD9FZlD,aAAc,SAACmC,GC+Fb,MD/F6BnC,GAAaiD,KAACxE,EAAG0D,ICkGhDjD,EAAYgE,UDjGZG,gBAAiB,WCkGf,MDlGkBtD,GAAYkD,KAACxE,ICqGjCS,EAAYgE,UDpGZjD,KAAM,SAACkC,GCqGL,MDpGA,IAAIc,MAACK,YAAarD,EAAKgD,KAACxE,EAAG0D,EAAac,KAACF,YAAaE,KAACM,WAAYN,KAACD,MAAQ,ICuG9E9D,EAAYgE,UDtGZK,SAAU,WAAG,MAAGN,MAACF,aAAczD,EAAOD,EAAOC,GC8G7CJ,EAAYgE,UD7GZM,SAAU,WC8GR,MD9GWpD,GAAK6C,KAACxE,ICiHZS,KD/GTD,EAAOJ,SACLU,EAAAA,EAAGD,EAAAA,EAAGD,EAAAA,EACNI,MAAAA,EACAe,OAAAA,EAAQV,MAAAA,EAAOQ,MAAAA,EAAOV,OAAAA,EAAQC,WAAAA,EAC9BF,cAAAA,EAAeI,YAAAA,EAAaC,aAAAA,EAAcC,KAAAA,EAAMP,SAAAA,EAChDR,YAAAA,KCiICuE,UAAU,IAAIC,GAAG,SAASnF,EAAQU,EAAOJ,GCtQ5C,GAAAK,GAAAyE,EAAAC,EAAAC,EAAAC,EAAA/D,EAAAgE,EAAAC,EAAA9D,EAAA+D,CAACL,GAAgBrF,EAAQ,WAARqF,aACjB1D,EAA6B3B,EAAQ,kBAApCW,EAAAgB,EAAAhB,YAAaa,EAAAG,EAAAH,YACd4D,EAAOzE,EAGP8E,EAAS,SAAC5F,EAAGH,GD2QX,MC3QiBmD,MAAK8C,MAAM9C,KAAK4C,UAAU/F,EAAEG,GAAGA,IAGlD6F,EAAU,SAACxF,GACT,GAAAL,GAAAsC,EAAAC,EAAA1C,EAAAkC,EAAAyB,CACA,IADA3D,EAAIQ,EAAEM,OACW,IAALd,EAAZ,MAAOQ,EACP,KAASL,EAAAuC,EAAA,EAAAR,EAAAlC,EAAA,EAAA,GAAAkC,EAAAQ,EAAAR,EAAAQ,EAAAR,EAAA/B,EAAA,GAAA+B,IAAAQ,IAAAA,EACPD,EAAIsD,EAAO5F,EAAGH,GACd2D,GAAenD,EAAEiC,GAAGjC,EAAEL,IAArBK,EAAEL,GAAAwD,EAAA,GAAGnD,EAAEiC,GAAAkB,EAAA,EDgRV,OC/QAnD,IAEFS,EAAWgE,UAAEG,gBAAkB,WDiR7B,MCjRgCY,GAAQlE,EAAYkD,KAACxE,KAEvDsF,EAAS,KACTD,EAAO,KAEPK,KAAKC,UAAY,SAACpG,GAChB,GAAAqG,GAAArB,EAAAsB,CAAA,QAAOtG,EAAEuG,KAAKC,SAAd,IACO,QDuRH,MCtRAV,GAAO,GAAIH,GACXX,EAAQhF,EAAEuG,KAAKE,KAAKzB,MACpBe,EAASF,EAAeb,EAJ5B,KAKO,OD2RH,MC1RAsB,GAAatG,EAAEuG,KAAKE,KAAKH,WACM,MAAAA,IAA/BR,EAAOA,EAAK7D,KAAKqE,IACjBD,EAASN,EAAO9D,KAAK6D,GACrBA,EAAOA,EAAK7D,KAAKoE,GACjBF,KAAKO,aAAaL,OAAAA,MAExBR,EAAiB,SAACb,GAChB,GAAA2B,ED+RA,OAJa,OAAT3B,IC5RYA,EAAQ,GACxB2B,EAAQ,GAAIf,GAAaZ,IACzB/C,KAAM,SAAC6D,GACL,IAAUA,EAAKjE,aDkSb,MCjSF8E,GAAMC,WAAWd,QDuSlBe,iBAAiB,EAAEpB,UAAU,IAAIqB,GAAG,SAASvG,EAAQU,EAAOJ,GE7U/D,GAAAkG,GAAAC,EAAA9E,CAEAA,IAAA,EAAA,GAAA6E,EAAA7E,EAAA,GAAA8E,EAAA9E,EAAA,GAEAjB,EAAAJ,SACAkG,GAAAA,EACAC,GAAAA,QFiVMC,GAAG,SAAS1G,EAAQU,EAAOJ,GGvVjC,GAAAqG,GAAA/F,EAAAC,EAAAwE,EAAAmB,EAAAC,EAAA9E,EAAAC,CAEAD,GAAA3B,EAAA,UAAAwG,EAAA7E,EAAA6E,GAAAC,EAAA9E,EAAA8E,GAEA7E,GAAA4E,EAAAC,GAAA7F,EAAAgB,EAAA,GAAAf,EAAAe,EAAA,GAEA+E,EAAAC,OAAAC,iBAEAxB,EAAA,WACA,QAAAA,GAAAZ,GACAC,KAAAD,MAAA,MAAAA,EAAAA,EAAAkC,EACAjC,KAAAoC,UAAAlG,EAwEA,MArEAyE,GAAAV,UAAA0B,WAAA,SAAAU,GACA,GAAA/F,GAAAgG,EAAA3D,CAGA,OAFAqB,MAAAoC,UAAAC,EAAAnC,YACAvB,EAAAqB,KAAAuC,QAAAF,GAAA/F,EAAAqC,EAAA,GAAA2D,EAAA3D,EAAA,GACA2D,GAGA3B,EAAAV,UAAAsC,QAAA,SAAAF,EAAAG,EAAAC,EAAAC,GACA,GAAA9F,EAcA,OAbA,OAAA4F,IACAA,GAAAP,GAEA,MAAAQ,IACAA,GAAAR,GAEA,MAAAS,IACAA,EAAA,GAEA9F,EAAAyF,EAAAzF,aACAA,GAAAyF,EAAAnC,cAAAF,KAAAoC,aACAM,EAEAA,EAAA1C,KAAAD,OAAAnD,GACAyF,EAAAlC,UAAA,MACAkC,EAAAnC,cAAAhE,EACA8D,KAAA2C,KAAAN,EAAAG,EAAAC,EAAAC,GAEA1C,KAAA4C,KAAAP,EAAAG,EAAAC,EAAAC,IAIA/B,EAAAV,UAAA0C,KAAA,SAAAN,EAAAG,EAAAC,EAAAC,GACA,GAAApG,GAAAd,EAAA4F,EAAAjG,EAAAuD,EAAAmE,EAAAlE,EAAAC,EAAAC,EAAAiE,EAAAC,EAAAC,CAGA,KAFArE,IAAAsD,EAAA,MAAAe,EAAArE,EAAA,GAAAnD,EAAAmD,EAAA,GACAC,EAAAyD,EAAAjC,kBACAjF,EAAA,EAAAuD,EAAAE,EAAA9C,OAAAX,EAAAuD,EAAAvD,IAAA,CAOA,GANAiG,EAAAxC,EAAAzD,GACA4H,EAAAV,EAAArF,KAAAoE,GACAvC,EAAAmB,KAAAuC,QAAAQ,EAAAP,EAAAC,EAAAC,GAAAG,EAAAhE,EAAA,GAAAvC,EAAAuC,EAAA,GACAgE,EAAAG,IACAF,GAAAD,EAAAzB,GAAA4B,EAAAF,EAAA,GAAAtH,EAAAsH,EAAA,IAEAE,GAAAP,EACA,OAAAO,EAAAxH,EAEAgH,GAAArE,KAAA8E,IAAAT,EAAAQ,GAEA,OAAAA,EAAAxH,IAGAmF,EAAAV,UAAA2C,KAAA,SAAAP,EAAAG,EAAAC,EAAAC,GACA,GAAApG,GAAAd,EAAA4F,EAAAjG,EAAAuD,EAAAmE,EAAAlE,EAAAC,EAAAC,EAAAiE,EAAAC,EAAAC,CAGA,KAFArE,IAAAsD,EAAA,MAAAe,EAAArE,EAAA,GAAAnD,EAAAmD,EAAA,GACAC,EAAAyD,EAAAjC,kBACAjF,EAAA,EAAAuD,EAAAE,EAAA9C,OAAAX,EAAAuD,EAAAvD,IAAA,CAOA,GANAiG,EAAAxC,EAAAzD,GACA4H,EAAAV,EAAArF,KAAAoE,GACAvC,EAAAmB,KAAAuC,QAAAQ,EAAAP,EAAAC,EAAAC,GAAAG,EAAAhE,EAAA,GAAAvC,EAAAuC,EAAA,GACAgE,EAAAG,IACAF,GAAAD,EAAAzB,GAAA4B,EAAAF,EAAA,GAAAtH,EAAAsH,EAAA,IAEAE,GAAAR,EACA,OAAAQ,EAAAxH,EAEAiH,GAAAtE,KAAAC,IAAAqE,EAAAO,GAEA,OAAAA,EAAAxH,IAGAmF,KAIA3E,EAAAJ,SACAM,IAAAA,EACAC,IAAAA,EACA8F,MAAAA,EACAtB,aAAAA,KH2VGuC,SAAS,SAAS","file":"minimax-worker.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","# coffeelint: disable=max_line_length\n{MAX, MIN} = require 'aye-aye'\n\n[_, X, O] = [0, 1, 2]\n\n# empty board\nempty = [\n  _, _, _, _, _, _, _\n  _, _, _, _, _, _, _\n  _, _, _, _, _, _, _\n  _, _, _, _, _, _, _\n  _, _, _, _, _, _, _\n  _, _, _, _, _, _, _\n]\n\n# array with all 4-tuple indices of board positions\n# where a player can win the game\nwinnableIndices = do ->\n  res = []\n  for i in [0...4]\n    # rows\n    for j in [0...6]\n      k=i+j*7\n      res.push [k,k+1,k+2,k+3]\n    # left diagonals\n    for j in [0...3]\n      k=i+j*7\n      res.push [k,k+7+1,k+7*2+2,k+7*3+3]\n  for j in [0...3]\n    # columns\n    for i in [0...7]\n      k=i+j*7\n      res.push [k,k+7,k+7*2,k+7*3]\n    # right diagonals\n    for i in [3...7]\n      k=i+j*7\n      res.push [k,k+7-1,k+7*2-2,k+7*3-3]\n  # sort based on bottom-up board position\n  res.sort (x, y) -> (Math.min y...) - (Math.min x...)\n\nwinner = (a) ->\n  for [i1,i2,i3,i4] in winnableIndices\n    return a[i1] if a[i1] isnt _ and a[i1] is a[i2] is a[i3] is a[i4]\n  null\n\nisWin = (a, W) -> (winner a) is W\n\nwonIndices = (a, [i1,i2,i3,i4]) ->\n  a[i1] isnt _ and a[i1] is a[i2] is a[i3] is a[i4]\n\nwinOn = (a) ->\n  for indices in winnableIndices\n    return indices if wonIndices a, indices\n  []\n\nisFull = (a) ->\n  for i in [0...7]\n    return no if a[i] is _\n  yes\n\nisTerminal = (a) ->\n  (isFull a) or !!(winner a)\n\nopenColumns = (a) ->\n  i for i in [0...7] when a[i] is _\n\nfreePositions = (a) ->\n  i for i in [0...42] when a[i] is _\n\nopenPosition = (a, columnIndex) ->\n  for rowIndex in [5..0]\n    index = rowIndex*7+columnIndex\n    return index if a[index] is _\n\n# this is a bit faster than using Array::slice\ncopy = (a) ->\n  i = 42\n  b = new Array i\n  b[i] = a[i] while i--\n  b\n\nplay = (a, columnIndex, W) ->\n  index = openPosition a, columnIndex\n  b = copy a\n  b[index] = W\n  b\n\nscores = [1,10,100,1000,10000]\nevaluate = (a) ->\n  score = 0\n  for indices in winnableIndices\n    [x, o] = [0, 0]\n    for i in indices\n      ++x if a[i] is X\n      ++o if a[i] is O\n    score += scores[x] - scores[o] if x is 0 or o is 0\n  score\n\nrepr = (a) ->\n  boardStr = \"\"\n  for row in [0...6]\n    for col in [0...7]\n      piece = a[row * 7 + col]\n      if piece is X\n        boardStr += \"X \"\n      else if piece is O\n        boardStr += \"O \"\n      else\n        boardStr += \"_ \"\n    boardStr += \"\\n\"\n  boardStr\n\nclass ConnectFour\n  constructor: (@a = empty, @nextPlayer = X, @depth = 0) ->\n  isWin: (W) -> isWin @a, W\n  winOn: -> winOn @a\n  winner: -> winner @a\n  isTerminal: -> @depth >= 7 and isTerminal @a\n  nextAgent: -> if @nextPlayer is X then MAX else MIN\n  utility: -> evaluate @a\n  freePositions: -> freePositions @a\n  openPosition: (columnIndex) -> openPosition @a, columnIndex\n  possibleActions: -> openColumns @a\n  play: (columnIndex) ->\n    new @constructor (play @a, columnIndex, @nextPlayer), @opponent(), @depth + 1\n  opponent: -> if @nextPlayer is X then O else X\n  toString: -> repr @a\n\nmodule.exports = {\n  _, X, O\n  empty\n  winner, isWin, winOn, isFull, isTerminal\n  freePositions, openColumns, openPosition, play, evaluate\n  ConnectFour\n}\n","(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\nvar ConnectFour, MAX, MIN, O, X, _, copy, empty, evaluate, freePositions, isFull, isTerminal, isWin, openColumns, openPosition, play, ref, ref1, repr, scores, winOn, winnableIndices, winner, wonIndices;\n\nref = require('aye-aye'), MAX = ref.MAX, MIN = ref.MIN;\n\nref1 = [0, 1, 2], _ = ref1[0], X = ref1[1], O = ref1[2];\n\nempty = [_, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _];\n\nwinnableIndices = (function() {\n  var i, j, k, l, m, n, p, q, r, res;\n  res = [];\n  for (i = l = 0; l < 4; i = ++l) {\n    for (j = m = 0; m < 6; j = ++m) {\n      k = i + j * 7;\n      res.push([k, k + 1, k + 2, k + 3]);\n    }\n    for (j = n = 0; n < 3; j = ++n) {\n      k = i + j * 7;\n      res.push([k, k + 7 + 1, k + 7 * 2 + 2, k + 7 * 3 + 3]);\n    }\n  }\n  for (j = p = 0; p < 3; j = ++p) {\n    for (i = q = 0; q < 7; i = ++q) {\n      k = i + j * 7;\n      res.push([k, k + 7, k + 7 * 2, k + 7 * 3]);\n    }\n    for (i = r = 3; r < 7; i = ++r) {\n      k = i + j * 7;\n      res.push([k, k + 7 - 1, k + 7 * 2 - 2, k + 7 * 3 - 3]);\n    }\n  }\n  return res.sort(function(x, y) {\n    return (Math.min.apply(Math, y)) - (Math.min.apply(Math, x));\n  });\n})();\n\nwinner = function(a) {\n  var i1, i2, i3, i4, l, len, ref2, ref3, ref4;\n  for (l = 0, len = winnableIndices.length; l < len; l++) {\n    ref2 = winnableIndices[l], i1 = ref2[0], i2 = ref2[1], i3 = ref2[2], i4 = ref2[3];\n    if (a[i1] !== _ && ((a[i1] === (ref4 = a[i2]) && ref4 === (ref3 = a[i3])) && ref3 === a[i4])) {\n      return a[i1];\n    }\n  }\n  return null;\n};\n\nisWin = function(a, W) {\n  return (winner(a)) === W;\n};\n\nwonIndices = function(a, arg) {\n  var i1, i2, i3, i4, ref2, ref3;\n  i1 = arg[0], i2 = arg[1], i3 = arg[2], i4 = arg[3];\n  return a[i1] !== _ && ((a[i1] === (ref3 = a[i2]) && ref3 === (ref2 = a[i3])) && ref2 === a[i4]);\n};\n\nwinOn = function(a) {\n  var indices, l, len;\n  for (l = 0, len = winnableIndices.length; l < len; l++) {\n    indices = winnableIndices[l];\n    if (wonIndices(a, indices)) {\n      return indices;\n    }\n  }\n  return [];\n};\n\nisFull = function(a) {\n  var i, l;\n  for (i = l = 0; l < 7; i = ++l) {\n    if (a[i] === _) {\n      return false;\n    }\n  }\n  return true;\n};\n\nisTerminal = function(a) {\n  return (isFull(a)) || !!(winner(a));\n};\n\nopenColumns = function(a) {\n  var i, l, results;\n  results = [];\n  for (i = l = 0; l < 7; i = ++l) {\n    if (a[i] === _) {\n      results.push(i);\n    }\n  }\n  return results;\n};\n\nfreePositions = function(a) {\n  var i, l, results;\n  results = [];\n  for (i = l = 0; l < 42; i = ++l) {\n    if (a[i] === _) {\n      results.push(i);\n    }\n  }\n  return results;\n};\n\nopenPosition = function(a, columnIndex) {\n  var index, l, rowIndex;\n  for (rowIndex = l = 5; l >= 0; rowIndex = --l) {\n    index = rowIndex * 7 + columnIndex;\n    if (a[index] === _) {\n      return index;\n    }\n  }\n};\n\ncopy = function(a) {\n  var b, i;\n  i = 42;\n  b = new Array(i);\n  while (i--) {\n    b[i] = a[i];\n  }\n  return b;\n};\n\nplay = function(a, columnIndex, W) {\n  var b, index;\n  index = openPosition(a, columnIndex);\n  b = copy(a);\n  b[index] = W;\n  return b;\n};\n\nscores = [1, 10, 100, 1000, 10000];\n\nevaluate = function(a) {\n  var i, indices, l, len, len1, m, o, ref2, score, x;\n  score = 0;\n  for (l = 0, len = winnableIndices.length; l < len; l++) {\n    indices = winnableIndices[l];\n    ref2 = [0, 0], x = ref2[0], o = ref2[1];\n    for (m = 0, len1 = indices.length; m < len1; m++) {\n      i = indices[m];\n      if (a[i] === X) {\n        ++x;\n      }\n      if (a[i] === O) {\n        ++o;\n      }\n    }\n    if (x === 0 || o === 0) {\n      score += scores[x] - scores[o];\n    }\n  }\n  return score;\n};\n\nrepr = function(a) {\n  var boardStr, col, l, m, piece, row;\n  boardStr = \"\";\n  for (row = l = 0; l < 6; row = ++l) {\n    for (col = m = 0; m < 7; col = ++m) {\n      piece = a[row * 7 + col];\n      if (piece === X) {\n        boardStr += \"X \";\n      } else if (piece === O) {\n        boardStr += \"O \";\n      } else {\n        boardStr += \"_ \";\n      }\n    }\n    boardStr += \"\\n\";\n  }\n  return boardStr;\n};\n\nConnectFour = (function() {\n  function ConnectFour(a1, nextPlayer, depth) {\n    this.a = a1 != null ? a1 : empty;\n    this.nextPlayer = nextPlayer != null ? nextPlayer : X;\n    this.depth = depth != null ? depth : 0;\n  }\n\n  ConnectFour.prototype.isWin = function(W) {\n    return isWin(this.a, W);\n  };\n\n  ConnectFour.prototype.winOn = function() {\n    return winOn(this.a);\n  };\n\n  ConnectFour.prototype.winner = function() {\n    return winner(this.a);\n  };\n\n  ConnectFour.prototype.isTerminal = function() {\n    return this.depth >= 7 && isTerminal(this.a);\n  };\n\n  ConnectFour.prototype.nextAgent = function() {\n    if (this.nextPlayer === X) {\n      return MAX;\n    } else {\n      return MIN;\n    }\n  };\n\n  ConnectFour.prototype.utility = function() {\n    return evaluate(this.a);\n  };\n\n  ConnectFour.prototype.freePositions = function() {\n    return freePositions(this.a);\n  };\n\n  ConnectFour.prototype.openPosition = function(columnIndex) {\n    return openPosition(this.a, columnIndex);\n  };\n\n  ConnectFour.prototype.possibleActions = function() {\n    return openColumns(this.a);\n  };\n\n  ConnectFour.prototype.play = function(columnIndex) {\n    return new this.constructor(play(this.a, columnIndex, this.nextPlayer), this.opponent(), this.depth + 1);\n  };\n\n  ConnectFour.prototype.opponent = function() {\n    if (this.nextPlayer === X) {\n      return O;\n    } else {\n      return X;\n    }\n  };\n\n  ConnectFour.prototype.toString = function() {\n    return repr(this.a);\n  };\n\n  return ConnectFour;\n\n})();\n\nmodule.exports = {\n  _: _,\n  X: X,\n  O: O,\n  empty: empty,\n  winner: winner,\n  isWin: isWin,\n  winOn: winOn,\n  isFull: isFull,\n  isTerminal: isTerminal,\n  freePositions: freePositions,\n  openColumns: openColumns,\n  openPosition: openPosition,\n  play: play,\n  evaluate: evaluate,\n  ConnectFour: ConnectFour\n};\n\n\n},{\"aye-aye\":4}],2:[function(require,module,exports){\nvar ConnectFour, Game, MinimaxAgent, computerPlayer, game, openColumns, player, random, ref, shuffle;\n\nMinimaxAgent = require('aye-aye').MinimaxAgent;\n\nref = require('./connect-four'), ConnectFour = ref.ConnectFour, openColumns = ref.openColumns;\n\nGame = ConnectFour;\n\nrandom = function(i, n) {\n  return Math.floor(Math.random() * (n - i) + i);\n};\n\nshuffle = function(a) {\n  var i, j, k, n, ref1, ref2;\n  n = a.length;\n  if (n === 0) {\n    return a;\n  }\n  for (i = k = 0, ref1 = n - 1; 0 <= ref1 ? k < ref1 : k > ref1; i = 0 <= ref1 ? ++k : --k) {\n    j = random(i, n);\n    ref2 = [a[j], a[i]], a[i] = ref2[0], a[j] = ref2[1];\n  }\n  return a;\n};\n\nConnectFour.prototype.possibleActions = function() {\n  return shuffle(openColumns(this.a));\n};\n\nplayer = null;\n\ngame = null;\n\nself.onmessage = function(e) {\n  var action, depth, lastAction;\n  switch (e.data.command) {\n    case 'setup':\n      game = new Game;\n      depth = e.data.args.depth;\n      return player = computerPlayer(depth);\n    case 'play':\n      lastAction = e.data.args.lastAction;\n      if (lastAction != null) {\n        game = game.play(lastAction);\n      }\n      action = player.play(game);\n      game = game.play(action);\n      return self.postMessage({\n        action: action\n      });\n  }\n};\n\ncomputerPlayer = function(depth) {\n  var agent;\n  if (depth == null) {\n    depth = 3;\n  }\n  agent = new MinimaxAgent(depth);\n  return {\n    play: function(game) {\n      if (game.isTerminal()) {\n        return;\n      }\n      return agent.nextAction(game);\n    }\n  };\n};\n\n\n},{\"./connect-four\":1,\"aye-aye\":4}],3:[function(require,module,exports){\nvar P1, P2, ref;\n\nref = [1, 2], P1 = ref[0], P2 = ref[1];\n\nmodule.exports = {\n  P1: P1,\n  P2: P2\n};\n\n},{}],4:[function(require,module,exports){\nvar Limit, MAX, MIN, MinimaxAgent, P1, P2, ref, ref1;\n\nref = require('./game'), P1 = ref.P1, P2 = ref.P2;\n\nref1 = [P1, P2], MAX = ref1[0], MIN = ref1[1];\n\nLimit = Number.MAX_SAFE_INTEGER;\n\nMinimaxAgent = (function() {\n  function MinimaxAgent(depth) {\n    this.depth = depth != null ? depth : Limit;\n    this.rootAgent = MAX;\n  }\n\n  MinimaxAgent.prototype.nextAction = function(state) {\n    var _, bestAction, ref2;\n    this.rootAgent = state.nextAgent();\n    ref2 = this.minimax(state), _ = ref2[0], bestAction = ref2[1];\n    return bestAction;\n  };\n\n  MinimaxAgent.prototype.minimax = function(state, α, β, ply) {\n    var isTerminal;\n    if (α == null) {\n      α = -Limit;\n    }\n    if (β == null) {\n      β = +Limit;\n    }\n    if (ply == null) {\n      ply = 0;\n    }\n    isTerminal = state.isTerminal();\n    if (!isTerminal && state.nextAgent() === this.rootAgent) {\n      ++ply;\n    }\n    if (ply > this.depth || isTerminal) {\n      return [state.utility(), null];\n    } else if (state.nextAgent() === MAX) {\n      return this.maxi(state, α, β, ply);\n    } else {\n      return this.mini(state, α, β, ply);\n    }\n  };\n\n  MinimaxAgent.prototype.maxi = function(state, α, β, ply) {\n    var _, a, action, i, len, nextValue, ref2, ref3, ref4, ref5, successor, v;\n    ref2 = [-Limit, null], v = ref2[0], a = ref2[1];\n    ref3 = state.possibleActions();\n    for (i = 0, len = ref3.length; i < len; i++) {\n      action = ref3[i];\n      successor = state.play(action);\n      ref4 = this.minimax(successor, α, β, ply), nextValue = ref4[0], _ = ref4[1];\n      if (nextValue > v) {\n        ref5 = [nextValue, action], v = ref5[0], a = ref5[1];\n      }\n      if (v >= β) {\n        return [v, a];\n      }\n      α = Math.max(α, v);\n    }\n    return [v, a];\n  };\n\n  MinimaxAgent.prototype.mini = function(state, α, β, ply) {\n    var _, a, action, i, len, nextValue, ref2, ref3, ref4, ref5, successor, v;\n    ref2 = [+Limit, null], v = ref2[0], a = ref2[1];\n    ref3 = state.possibleActions();\n    for (i = 0, len = ref3.length; i < len; i++) {\n      action = ref3[i];\n      successor = state.play(action);\n      ref4 = this.minimax(successor, α, β, ply), nextValue = ref4[0], _ = ref4[1];\n      if (nextValue < v) {\n        ref5 = [nextValue, action], v = ref5[0], a = ref5[1];\n      }\n      if (v <= α) {\n        return [v, a];\n      }\n      β = Math.min(β, v);\n    }\n    return [v, a];\n  };\n\n  return MinimaxAgent;\n\n})();\n\nmodule.exports = {\n  MAX: MAX,\n  MIN: MIN,\n  Limit: Limit,\n  MinimaxAgent: MinimaxAgent\n};\n\n},{\"./game\":3}]},{},[2])\n\n","{MinimaxAgent} = require 'aye-aye'\n{ConnectFour, openColumns} = require './connect-four'\nGame = ConnectFour\n\n# returns random j such that i ≤ j < n\nrandom = (i, n) -> Math.floor(Math.random()*(n-i)+i)\n\n# Fisher–Yates\nshuffle = (a) ->\n  n = a.length\n  return a if n is 0\n  for i in [0...n-1]\n    j = random i, n\n    [a[i],a[j]] = [a[j],a[i]]\n  a\n\nConnectFour::possibleActions = -> shuffle openColumns @a\n\nplayer = null\ngame = null\n\nself.onmessage = (e) ->\n  switch e.data.command\n    when 'setup'\n      game = new Game\n      depth = e.data.args.depth\n      player = computerPlayer depth\n    when 'play'\n      lastAction = e.data.args.lastAction\n      game = game.play lastAction if lastAction?\n      action = player.play game\n      game = game.play action\n      self.postMessage {action}\n\ncomputerPlayer = (depth = 3) ->\n  agent = new MinimaxAgent depth\n  play: (game) ->\n    return if game.isTerminal()\n    agent.nextAction game\n","var P1, P2, ref;\n\nref = [1, 2], P1 = ref[0], P2 = ref[1];\n\nmodule.exports = {\n  P1: P1,\n  P2: P2\n};\n","var Limit, MAX, MIN, MinimaxAgent, P1, P2, ref, ref1;\n\nref = require('./game'), P1 = ref.P1, P2 = ref.P2;\n\nref1 = [P1, P2], MAX = ref1[0], MIN = ref1[1];\n\nLimit = Number.MAX_SAFE_INTEGER;\n\nMinimaxAgent = (function() {\n  function MinimaxAgent(depth) {\n    this.depth = depth != null ? depth : Limit;\n    this.rootAgent = MAX;\n  }\n\n  MinimaxAgent.prototype.nextAction = function(state) {\n    var _, bestAction, ref2;\n    this.rootAgent = state.nextAgent();\n    ref2 = this.minimax(state), _ = ref2[0], bestAction = ref2[1];\n    return bestAction;\n  };\n\n  MinimaxAgent.prototype.minimax = function(state, α, β, ply) {\n    var isTerminal;\n    if (α == null) {\n      α = -Limit;\n    }\n    if (β == null) {\n      β = +Limit;\n    }\n    if (ply == null) {\n      ply = 0;\n    }\n    isTerminal = state.isTerminal();\n    if (!isTerminal && state.nextAgent() === this.rootAgent) {\n      ++ply;\n    }\n    if (ply > this.depth || isTerminal) {\n      return [state.utility(), null];\n    } else if (state.nextAgent() === MAX) {\n      return this.maxi(state, α, β, ply);\n    } else {\n      return this.mini(state, α, β, ply);\n    }\n  };\n\n  MinimaxAgent.prototype.maxi = function(state, α, β, ply) {\n    var _, a, action, i, len, nextValue, ref2, ref3, ref4, ref5, successor, v;\n    ref2 = [-Limit, null], v = ref2[0], a = ref2[1];\n    ref3 = state.possibleActions();\n    for (i = 0, len = ref3.length; i < len; i++) {\n      action = ref3[i];\n      successor = state.play(action);\n      ref4 = this.minimax(successor, α, β, ply), nextValue = ref4[0], _ = ref4[1];\n      if (nextValue > v) {\n        ref5 = [nextValue, action], v = ref5[0], a = ref5[1];\n      }\n      if (v >= β) {\n        return [v, a];\n      }\n      α = Math.max(α, v);\n    }\n    return [v, a];\n  };\n\n  MinimaxAgent.prototype.mini = function(state, α, β, ply) {\n    var _, a, action, i, len, nextValue, ref2, ref3, ref4, ref5, successor, v;\n    ref2 = [+Limit, null], v = ref2[0], a = ref2[1];\n    ref3 = state.possibleActions();\n    for (i = 0, len = ref3.length; i < len; i++) {\n      action = ref3[i];\n      successor = state.play(action);\n      ref4 = this.minimax(successor, α, β, ply), nextValue = ref4[0], _ = ref4[1];\n      if (nextValue < v) {\n        ref5 = [nextValue, action], v = ref5[0], a = ref5[1];\n      }\n      if (v <= α) {\n        return [v, a];\n      }\n      β = Math.min(β, v);\n    }\n    return [v, a];\n  };\n\n  return MinimaxAgent;\n\n})();\n\nmodule.exports = {\n  MAX: MAX,\n  MIN: MIN,\n  Limit: Limit,\n  MinimaxAgent: MinimaxAgent\n};\n"]}